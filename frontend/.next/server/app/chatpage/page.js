(()=>{var e={};e.id=846,e.ids=[846],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2412:e=>{"use strict";e.exports=require("assert")},9428:e=>{"use strict";e.exports=require("buffer")},9646:e=>{"use strict";e.exports=require("child_process")},5511:e=>{"use strict";e.exports=require("crypto")},4735:e=>{"use strict";e.exports=require("events")},9021:e=>{"use strict";e.exports=require("fs")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},1645:e=>{"use strict";e.exports=require("net")},3873:e=>{"use strict";e.exports=require("path")},7910:e=>{"use strict";e.exports=require("stream")},4631:e=>{"use strict";e.exports=require("tls")},3997:e=>{"use strict";e.exports=require("tty")},9551:e=>{"use strict";e.exports=require("url")},8354:e=>{"use strict";e.exports=require("util")},4075:e=>{"use strict";e.exports=require("zlib")},1992:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>o});var a=t(260),r=t(8203),l=t(5155),i=t.n(l),n=t(7292),c={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(s,c);let o=["",{children:["chatpage",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,8602)),"D:\\realtime_Chatapp\\frontend\\app\\chatpage\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,6055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,9611)),"D:\\realtime_Chatapp\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,1129)),"D:\\realtime_Chatapp\\frontend\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,1485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,6055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["D:\\realtime_Chatapp\\frontend\\app\\chatpage\\page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/chatpage/page",pathname:"/chatpage",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},2842:(e,s,t)=>{Promise.resolve().then(t.bind(t,8602))},5890:(e,s,t)=>{Promise.resolve().then(t.bind(t,8615))},8615:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>w});var a=t(5512),r=t(8891),l=t(2803);let i="development"===process.env.MODE?"http://localhost:3001":"/",n=(0,l.v)((e,s)=>({messages:[],users:[],socket:null,selectedUser:null,isUserLoading:!1,isMessagesLoading:!1,setSelectedUser:s=>e({selectedUser:s}),getUsers:async()=>{e({isUserLoading:!0});try{let s=await fetch(`${i}/api/message/getUsers`,{method:"GET",credentials:"include"}),t=await s.json();e({users:t})}catch(e){console.error("Failed to fetch users:",e)}finally{e({isUserLoading:!1})}},getMessages:async s=>{e({isMessagesLoading:!0});try{let t=await fetch(`${i}/api/message/${s}`,{method:"GET",credentials:"include"}),a=await t.json();e({messages:a})}catch(e){console.error(`Failed to fetch messages for user ${s}:`,e)}finally{e({isMessagesLoading:!1})}},deleteMessage:async t=>{let{messages:a}=s();try{if(!(await fetch(`${i}/api/message/delete/${t}`,{method:"DELETE",credentials:"include"})).ok)throw Error("Failed to delete message");e({messages:a.filter(e=>e._id!==t)})}catch(e){console.error(`Failed to delete message ${t}:`,e)}finally{e({isMessagesLoading:!1})}},sendMessage:async t=>{let{selectedUser:a,messages:r}=s();if(!Array.isArray(r)){console.error("Messages state is not an array.");return}if(!a){console.error("No selected user.");return}try{let s=await fetch(`${i}/api/message/send/${a._id}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error("Failed to send message");let l=await s.json();if(!l||!l._id){console.error("Invalid message data received from server:",l);return}e({messages:[...r,l]})}catch(e){console.error("Error sending message:",e)}},subscribeToMessages:()=>{let{selectedUser:t}=s(),{socket:a}=r.n.getState();if(!t){console.error("Socket or selected user is not available");return}if(!a){console.error("Socket is not available");return}a?.off("newMessage"),a?.on("newMessage",a=>{a.sender===t._id&&e({messages:[...s().messages,a]})})},unsubscribeFromMessages:()=>{let{socket:e}=r.n.getState();e?e.off("newMessage"):console.error("Socket is not initialized")}}));var c=t(1680);let o=(0,c.A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),d=()=>(0,a.jsx)("div",{className:" border-t border-r w-full flex flex-1 flex-col items-center justify-center p-16 dark:bg-slate-900",children:(0,a.jsxs)("div",{className:"max-w-md text-center space-y-6 ",children:[(0,a.jsx)("div",{className:"flex justify-center gap-4 mb-4",children:(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"w-16 h-16 rounded-2xl bg-primary/10 flex items-center   justify-center animate-bounce",children:(0,a.jsx)(o,{className:"w-8 h-8 text-primary "})})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Welcome to Chatty!"}),(0,a.jsx)("p",{className:"text-base-content/60",children:"Select a conversation from the sidebar to start chatting"})]})});var u=t(8009);let m=(0,c.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),x=()=>{let{selectedUser:e,setSelectedUser:s}=n();return e?(0,a.jsx)("div",{className:"p-2.5  border-base-300",children:(0,a.jsxs)("div",{className:"flex items-center justify-between border-b",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden relative",children:(0,a.jsx)("img",{src:e.profilePicture||"/avatar.png",alt:e.username,className:"w-full h-full object-cover"})}),(0,a.jsx)("div",{className:"text-base font-medium",children:e.username})]}),(0,a.jsx)("button",{onClick:()=>s(null),children:(0,a.jsx)(m,{})})]})}):(0,a.jsx)("div",{className:"p-2.5 border-b border-base-300",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)("span",{children:"No user selected"})}),(0,a.jsx)("button",{onClick:()=>s(null),children:(0,a.jsx)(m,{})})]})})},h=(0,c.A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),p=(0,c.A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),g=()=>{let[e,s]=(0,u.useState)(""),[t,l]=(0,u.useState)(null),i=(0,u.useRef)(null),{sendMessage:c}=n(),{authUser:o}=(0,r.n)(),d=async a=>{if(a.preventDefault(),e.trim()||t)try{await c({sender:o?._id,text:e.trim(),image:t||void 0}),s(""),l(null),i.current&&(i.current.value="")}catch(e){console.error("Failed to send message:",e)}};return(0,a.jsxs)("div",{className:"p-4 w-full",children:[t&&(0,a.jsx)("div",{className:"mb-3 flex items-center gap-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:t,alt:"Preview",className:"w-20 h-20 object-cover rounded-lg border dark:border-zinc-700"}),(0,a.jsx)("button",{onClick:()=>{l(null),i.current&&(i.current.value="")},className:"absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-base-300   flex items-center justify-center",type:"button",children:(0,a.jsx)(m,{className:"size-3"})})]})}),(0,a.jsxs)("form",{onSubmit:d,className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 flex gap-2",children:[(0,a.jsx)("input",{type:"text",className:"w-full dark:bg-slate-800 bg-slate-300 input input-bordered rounded-lg input-sm sm:input-md",placeholder:"Type a message...",value:e,onChange:e=>s(e.target.value)}),(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",ref:i,onChange:e=>{let s=e.target.files?e.target.files[0]:null;if(s&&s.type.startsWith("image/")){let e=new FileReader;e.onloadend=()=>{l(e.result)},e.readAsDataURL(s)}else console.log("Please select an image file")}}),(0,a.jsx)("button",{type:"button",className:`hidden sm:flex btn btn-circle
                        ${t?"text-emerald-500":"text-zinc-400"}`,onClick:()=>i.current?.click(),children:(0,a.jsx)(h,{size:20})})]}),(0,a.jsx)("button",{type:"submit",className:"btn btn-sm btn-circle",disabled:!e.trim()&&!t,children:(0,a.jsx)(p,{size:22})})]})]})},f=()=>{let e=Array(6).fill(null);return(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:e.map((e,s)=>(0,a.jsxs)("div",{className:`chat ${s%2==0?"chat-start":"chat-end"}`,children:[(0,a.jsx)("div",{className:"chat-image avatar",children:(0,a.jsx)("div",{className:"size-10 rounded-full",children:(0,a.jsx)("div",{className:"skeleton w-full h-full rounded-full bg-gray-200 dark:bg-gray-700"})})}),(0,a.jsx)("div",{className:"chat-header mb-1",children:(0,a.jsx)("div",{className:"skeleton h-4 w-16 bg-gray-200 dark:bg-gray-700"})}),(0,a.jsx)("div",{className:"chat-bubble bg-transparent p-0",children:(0,a.jsx)("div",{className:"skeleton h-16 w-[200px] bg-gray-200 dark:bg-gray-700"})})]},s))})},b=()=>{let{messages:e,getMessages:s,socket:t,deleteMessage:l,isMessagesLoading:i,selectedUser:c,subscribeToMessages:o,unsubscribeFromMessages:d}=n(),{authUser:m}=(0,r.n)();console.log("auth user in chat container is",m),console.log("messages in chat container are",e),console.log("selected user is",c),console.log("socket in chat container is",t);let[h,p]=(0,u.useState)(null),[b,v]=(0,u.useState)(null),j=()=>{let e=document.querySelector(".messages-container");e&&(e.scrollTop=e.scrollHeight)};(0,u.useEffect)(()=>(c?._id&&(s(c._id),t?.connect(),o()),()=>d()),[c?._id,s,o,d,t]),(0,u.useEffect)(()=>{e&&e.length>0&&(console.log("messages are",e),j())},[e]);let y=e=>{l(e)};return i?(0,a.jsxs)("div",{className:"flex-1 flex-col overflow-auto",children:[(0,a.jsx)(x,{}),(0,a.jsx)(f,{}),(0,a.jsx)(g,{})]}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden mb-6 ",children:[(0,a.jsx)(x,{}),(0,a.jsx)("div",{className:"messages-container h-full overflow-y-auto p-2 space-y-2 ",children:m&&e&&Array.isArray(e)&&e.map((e,s)=>(0,a.jsxs)("div",{className:`chat ${e.sender===m._id?"chat-end":"chat-start"}`,onMouseEnter:()=>p(e._id),onMouseLeave:()=>{p(null),v(null)},children:[(0,a.jsx)("div",{className:"chat-image avatar",children:(0,a.jsx)("div",{className:"size-10 rounded-full border",children:(0,a.jsx)("img",{src:e.sender===m._id?m?.profilePicture||"avatar.png":c?.profilePicture||"avatar.png",alt:"profile picture"})})}),(0,a.jsx)("div",{className:"chat-header mb-1",children:(0,a.jsx)("time",{className:"text-sm opacity-50 ml-1",children:new Date(e.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})})}),(0,a.jsxs)("div",{className:"chat-bubble flex flex-col relative dark:bg-slate-700  bg-gray-300 border-zinc-400 text-black",children:[h===e._id&&(0,a.jsxs)("div",{className:"absolute left-[-30px] top-0 flex space-x-1",children:[(0,a.jsx)("button",{className:"dark:text-white ",onClick:()=>v(e._id),children:"..."}),b===e._id&&(0,a.jsx)("button",{className:"text-white bg-red-600 relative bottom-5 right-8 rounded-full p-1",onClick:()=>y(e._id),children:"Delete"})]}),e?.image&&(0,a.jsx)("img",{src:e?.image,alt:"image",className:"w-[200px] h-auto object-cover"}),(0,a.jsx)("p",{className:"text-sm dark:text-zinc-300",children:e?.text||e.text||"No content"})]})]},e._id||`message-${s}`))}),(0,a.jsx)(g,{})]})},v=(0,c.A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),j=()=>{let e=Array(8).fill(null);return(0,a.jsxs)("aside",{className:"h-full w-20 lg:w-72 border-r border-base-300    flex flex-col transition-all duration-200",children:[(0,a.jsx)("div",{className:"border-b border-base-300 w-full p-5",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v,{className:"w-6 h-6"}),(0,a.jsx)("span",{className:"font-medium hidden lg:block",children:"Contacts"})]})}),(0,a.jsx)("div",{className:"overflow-y-auto w-full py-3",children:e.map((e,s)=>(0,a.jsxs)("div",{className:"w-full p-3 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"relative mx-auto lg:mx-0",children:(0,a.jsx)("div",{className:"skeleton size-12 rounded-full bg-gray-200 dark:bg-gray-700"})}),(0,a.jsxs)("div",{className:"hidden lg:block text-left min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"skeleton h-4 w-32 mb-2 bg-gray-200 dark:bg-gray-700"}),(0,a.jsx)("div",{className:"skeleton h-3 w-16 bg-gray-200 dark:bg-gray-700"})]})]},s))})]})},y=()=>{let{users:e,getUsers:s,selectedUser:t,setSelectedUser:l,isUserLoading:i}=n(),{onlineUsers:c}=(0,r.n)(),[o,d]=(0,u.useState)(!1);(0,u.useEffect)(()=>{s()},[s]);let m=o?e.filter(e=>c.includes(e._id)):e;return i?(0,a.jsx)(j,{}):(0,a.jsxs)("aside",{className:" border-t h-full dark:bg-slate-850 w-20 lg:w-72 border-r border-base-500 flex flex-col transition-all duration-200",children:[(0,a.jsxs)("div",{className:"border-b border-base-100 w-full p-5 ",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v,{className:"size-6"}),(0,a.jsx)("span",{className:"font-medium hidden lg:block text-lg",children:"Contacts"})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:o,onChange:e=>d(e.target.checked),className:"checkbox checkbox-sm accent-green-500 outline-2"}),(0,a.jsx)("span",{className:"text-sm dark:text-slate-200",children:"Show online users"})]})})]}),(0,a.jsx)("div",{className:"overflow-y-auto w-full py-3",children:m&&m.length>0?m.map(e=>(0,a.jsxs)("button",{onClick:()=>l(e),className:`w-full p-3 flex items-center gap-3 transition-colors ${t?._id===e._id?"dark:bg-slate-800 ring-base-300 bg-slate-200":"dark:hover:bg-slate-900 hover:bg-slate-200"}`,children:[(0,a.jsx)("div",{className:"relative mx-auto lg:mx-0",children:(0,a.jsx)("img",{src:e.profilePicture||"/avatar.png",alt:e.fullName,className:"size-12 object-cover rounded-full"})}),(0,a.jsxs)("div",{className:"hidden lg:flex flex-col text-left min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h1",{className:"font-medium truncate",children:e.username}),c.includes(e._id)&&(0,a.jsx)("span",{className:"size-3 bg-green-500 rounded-full ring-2 ring-zinc-900"})]}),(0,a.jsx)("div",{className:"text-sm dark:text-zinc-400 text-zinc-400",children:c.includes(e._id)?"Online":"Offline"})]})]},e._id)):(0,a.jsx)("div",{className:"text-center text-zinc-500 py-4",children:"No users available"})})]})};var N=t(5670);let k=()=>{let{authUser:e,onlineUsers:s,connectSocket:t}=(0,r.n)(),{selectedUser:l}=n();return console.log("Token is",e.token),console.log("Online users are",s),(0,u.useEffect)(()=>{e&&e._id?(console.log("authUser is available. Connecting socket..."),t()):console.log("Waiting for authUser to be available...")},[e?._id]),(0,a.jsx)("div",{className:"h-screen",children:(0,a.jsx)("div",{className:"flex items-center justify-center pt-10 border-black",children:(0,a.jsx)("div",{className:"dark:bg-slate-900 bg-slate-400/10 rounded-lg w-full max-w-6xl h-[calc(100vh-4rem)] px-4",children:(0,a.jsxs)("div",{className:"flex h-full rounded-lg overflow-hidden",children:[(0,a.jsx)(y,{}),l?(0,a.jsx)(b,{}):(0,a.jsx)(d,{})]})})})})},w=(0,N.default)(()=>Promise.resolve(k),{ssr:!1})},8602:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\realtime_Chatapp\\\\frontend\\\\app\\\\chatpage\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\realtime_Chatapp\\frontend\\app\\chatpage\\page.tsx","default")}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[638,222,634],()=>t(1992));module.exports=a})();